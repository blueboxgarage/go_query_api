graph TB
    %% External Components
    Client[ðŸ‘¤ Client Applications]
    CSV[ðŸ“Š field_mappings.csv]
    DB[(ðŸ—„ï¸ PostgreSQL Database)]
    Monitoring[ðŸ“Š Grafana/Prometheus]
    
    %% Load Balancer & Gateway
    subgraph "ðŸŒ Infrastructure"
        LoadBalancer[âš–ï¸ Load Balancer/nginx]
        Gateway[ðŸšª API Gateway]
    end
    
    %% Go Application
    subgraph "ðŸ¹ Go Application (Gin Framework)"
        subgraph "ðŸš€ HTTP Server Layer"
            GinEngine[ðŸš€ Gin HTTP Engine]
            Router[ðŸ”€ Gin Router]
            MiddlewareStack[ðŸ›¡ï¸ Middleware Stack]
        end
        
        subgraph "ðŸ“‹ HTTP Handlers"
            HealthHandler[â¤ï¸ Health Handler]
            QueryHandler[âš¡ Query Generator Handler]
            FieldsHandler[ðŸ“‹ Fields List Handler]
            MetricsHandler[ðŸ“Š Metrics Handler]
        end
        
        subgraph "ðŸª Application Services"
            AppConfig[âš™ï¸ Config Manager]
            FieldMatcherSvc[ðŸ” Field Matcher Service]
            NLPProcessorSvc[ðŸŽ¯ NLP Processor Service]
            QueryGeneratorSvc[ðŸ—ï¸ Query Generator Service]
            CSVLoaderSvc[ðŸ“„ CSV Loader Service]
        end
        
        subgraph "ðŸ§  Processing Engines"
            KeywordExtractor[ðŸ“ Keyword Extractor]
            FuzzyStringMatcher[ðŸŽ¯ Fuzzy String Matcher]
            IntentDetector[ðŸ§­ Intent Detector]
            ConfidenceCalculator[ðŸ“Š Confidence Calculator]
            SQLQueryBuilder[ðŸ—ï¸ SQL Query Builder]
        end
        
        subgraph "ðŸ’¾ Data Management"
            CSVParser[ðŸ“Š CSV Parser]
            FieldMappingsCache[ðŸ“¦ Field Mappings Cache]
            QueryResultCache[âš¡ Query Result Cache]
            ConfigStore[âš™ï¸ Configuration Store]
        end
        
        subgraph "ðŸ”§ Utilities & Helpers"
            Logger[ðŸ“ Structured Logger]
            ErrorHandler[âŒ Error Handler]
            Validator[âœ… Input Validator]
            ResponseBuilder[ðŸ“‹ Response Builder]
        end
        
        subgraph "ðŸ”— External Connectors"
            PostgreSQLClient[ðŸ˜ PostgreSQL Client]
            MetricsCollector[ðŸ“Š Metrics Collector]
            HealthChecker[â¤ï¸ Health Checker]
        end
    end
    
    %% Monitoring & Observability
    subgraph "ðŸ“Š Observability Stack"
        RequestTracing[ðŸ” Request Tracing]
        StructuredLogs[ðŸ“ Structured Logging]
        PrometheusMetrics[ðŸ“Š Prometheus Metrics]
        APMTracing[ðŸ”„ APM/Distributed Tracing]
    end
    
    %% Main Request Flow
    Client -->|HTTP Requests| LoadBalancer
    LoadBalancer --> Gateway
    Gateway -->|Route to Instance| GinEngine
    
    %% Application Startup Flow
    CSV -->|Load at Startup| CSVLoaderSvc
    CSVLoaderSvc --> CSVParser
    CSVParser -->|Parse & Validate| FieldMappingsCache
    FieldMappingsCache --> FieldMatcherSvc
    AppConfig --> ConfigStore
    ConfigStore --> GinEngine
    
    %% HTTP Request Processing
    GinEngine --> Router
    Router --> MiddlewareStack
    MiddlewareStack -->|CORS, Logging, Auth| HealthHandler
    MiddlewareStack --> QueryHandler
    MiddlewareStack --> FieldsHandler
    MiddlewareStack --> MetricsHandler
    
    %% Query Generation Flow
    QueryHandler -->|Validate Request| Validator
    QueryHandler --> FieldMatcherSvc
    QueryHandler --> NLPProcessorSvc
    QueryHandler --> QueryGeneratorSvc
    
    %% Field Matching Pipeline
    FieldMatcherSvc --> FieldMappingsCache
    FieldMatcherSvc --> FuzzyStringMatcher
    FieldMatcherSvc --> ConfidenceCalculator
    
    %% NLP Processing Pipeline
    NLPProcessorSvc --> KeywordExtractor
    NLPProcessorSvc --> IntentDetector
    KeywordExtractor --> FuzzyStringMatcher
    IntentDetector --> QueryGeneratorSvc
    
    %% Query Generation Pipeline
    QueryGeneratorSvc --> SQLQueryBuilder
    QueryGeneratorSvc --> ConfidenceCalculator
    SQLQueryBuilder --> ResponseBuilder
    
    %% Caching Layer
    FieldMatcherSvc --> QueryResultCache
    QueryGeneratorSvc --> QueryResultCache
    
    %% Database Integration (Optional)
    SQLQueryBuilder -.->|Validate Schema| PostgreSQLClient
    PostgreSQLClient -.->|Schema Info| DB
    DB -.->|Validation Results| PostgreSQLClient
    
    %% Error Handling Flow
    Validator -.->|Validation Errors| ErrorHandler
    FieldMatcherSvc -.->|Match Errors| ErrorHandler
    QueryGeneratorSvc -.->|Generation Errors| ErrorHandler
    ErrorHandler -.->|Error Response| ResponseBuilder
    
    %% Observability Integration
    MiddlewareStack --> RequestTracing
    MiddlewareStack --> StructuredLogs
    MiddlewareStack --> MetricsCollector
    
    Logger --> StructuredLogs
    MetricsCollector --> PrometheusMetrics
    RequestTracing --> APMTracing
    
    PrometheusMetrics --> Monitoring
    StructuredLogs --> Monitoring
    APMTracing --> Monitoring
    
    %% Health Check Flow
    HealthHandler --> HealthChecker
    HealthChecker --> CSVLoaderSvc
    HealthChecker --> FieldMappingsCache
    HealthChecker -.-> PostgreSQLClient
    
    %% Response Flow
    ResponseBuilder -->|JSON Response| QueryHandler
    QueryHandler -->|HTTP Response| GinEngine
    GinEngine -->|Response| Gateway
    Gateway --> LoadBalancer
    LoadBalancer --> Client
    
    %% Configuration Flow
    AppConfig -->|Runtime Config| GinEngine
    AppConfig --> FieldMatcherSvc
    AppConfig --> NLPProcessorSvc
    AppConfig --> QueryGeneratorSvc
    
    %% Middleware Components
    subgraph "ðŸ›¡ï¸ Middleware Components"
        CORSMiddleware[ðŸŒ CORS Middleware]
        LoggingMiddleware[ðŸ“ Logging Middleware]
        AuthMiddleware[ðŸ” Auth Middleware]
        RateLimitMiddleware[â±ï¸ Rate Limit Middleware]
        MetricsMiddleware[ðŸ“Š Metrics Middleware]
        TimeoutMiddleware[â° Timeout Middleware]
    end
    
    MiddlewareStack --> CORSMiddleware
    MiddlewareStack --> LoggingMiddleware
    MiddlewareStack --> AuthMiddleware
    MiddlewareStack --> RateLimitMiddleware
    MiddlewareStack --> MetricsMiddleware
    MiddlewareStack --> TimeoutMiddleware
    
    %% Styling
    classDef external fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef infrastructure fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef goapp fill:#00add8,stroke:#0066cc,stroke-width:3px,color:#fff
    classDef server fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef handlers fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef services fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef processing fill:#e0f2f1,stroke:#004d40,stroke-width:2px
    classDef data fill:#f1f8e9,stroke:#33691e,stroke-width:2px
    classDef utilities fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef connectors fill:#fff8e1,stroke:#f57f17,stroke-width:2px
    classDef observability fill:#e8eaf6,stroke:#3f51b5,stroke-width:2px
    classDef middleware fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    
    class Client,CSV,DB,Monitoring external
    class LoadBalancer,Gateway infrastructure
    class GinEngine,Router,MiddlewareStack server
    class HealthHandler,QueryHandler,FieldsHandler,MetricsHandler handlers
    class AppConfig,FieldMatcherSvc,NLPProcessorSvc,QueryGeneratorSvc,CSVLoaderSvc services
    class KeywordExtractor,FuzzyStringMatcher,IntentDetector,ConfidenceCalculator,SQLQueryBuilder processing
    class CSVParser,FieldMappingsCache,QueryResultCache,ConfigStore data
    class Logger,ErrorHandler,Validator,ResponseBuilder utilities
    class PostgreSQLClient,MetricsCollector,HealthChecker connectors
    class RequestTracing,StructuredLogs,PrometheusMetrics,APMTracing observability
    class CORSMiddleware,LoggingMiddleware,AuthMiddleware,RateLimitMiddleware,MetricsMiddleware,TimeoutMiddleware middleware
